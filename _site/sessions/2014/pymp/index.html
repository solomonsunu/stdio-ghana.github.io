<!doctype html> <html> <head> <title>STDIO Ghana - Python Multiprocessing</title> <link href='/assets/presentation-06bb482a381ca4157ef05da38d35ad5e.css' rel='stylesheet' type='text/css'/> <script type="text/javascript" src="http://stdio-ghana.github.io/js/head.min.js"></script> <script type="text/javascript" src="http://stdio-ghana.github.io/js/reveal.min.js"></script> </head> <body> <div class="reveal"><div class="slides"> <section> <h2>Python Multiprocessing</h2> Carl </section> <section> <h3 id="opinion">OPINION:</h3> <p>Support for developers using parallelization directly in Python is poor.</p> <p>If your problem cannot fit into a neat parallelization scheme, <em>do not use Python to solve it</em>.</p> <p>Many libraries accomplish parallel tasks by deferring to native code, so that can be another option.</p> </section> <section> <h2 id="from-am-session">From AM session:</h2> <div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
    <span class="n">ulim</span> <span class="o">=</span> <span class="mi">1000000000</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ulim</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;serial: {0:f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ulim</span><span class="p">,</span><span class="mi">1000</span><span class="p">)]</span>
    <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">input_list</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;parallel, inc. alloc.: {0:f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="n">input_list</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;straight parallel: {0:f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span></code></pre></div> <p>slightly more #'s than you had</p> </section> <section> <section> <h2 id="guess-run-times">Guess Run Times?</h2> </section> <section> <h2 id="try-it-and-move-onpymp1py"><a href="pymp1.py">Try it and move on</a></h2> </section> <section> <h2 id="how-parallelized">How Parallelized?</h2> </section> </section> <section> <h2 id="a-few-fundamental-approaches">a few fundamental approaches</h2> <p>Shared data containers that look a lot like atomic / synchronized vals in Java</p> <p>explicit shared state management via <code>Manager</code></p> <p><code>Process</code>: looks basically like Thread in Java <code>Pool</code>: very similar to OpenMP approach: execute some loop structure in parallel, ignore details of how it gets divvied up</p> <p>Uses <code>map</code>, <code>map_async</code>, and <code>apply</code>, <code>apply_async</code> for single items</p> </section> <section> <h2 id="explore-some-other-structurespymp2py"><a href="pymp2.py">Explore Some Other Structures</a></h2> </section> <section> <h2 id="python--multiprocessing-vs-c">Python + Multiprocessing vs. C++?</h2> <aside class="notes"> <p>When does it make sense to deal with parallelizing your code vs finding a c/cpp library and using it?</p> </aside> </section> <section> <h2 id="alternative-parallel-python-quickstarthttpwwwparallelpythoncomcontentview1530quicksmp">Alternative: <a href="http://www.parallelpython.com/content/view/15/30/#QUICKSMP">Parallel Python Quickstart</a></h2> </section> </div></div> <script>Reveal.initialize({controls:true,progress:true,history:true,center:true,theme:Reveal.getQueryHash().theme,transition:Reveal.getQueryHash().transition||"default",dependencies:[{src:"http://stdio-ghana.github.io/js/classList.js",condition:function(){return !document.body.classList}},{src:"http://stdio-ghana.github.io/js/notes.js",async:true,condition:function(){return !!document.body.classList}}]});</script> </body> </html>